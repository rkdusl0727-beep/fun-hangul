<script>
    let chars = [];
    const display = document.getElementById('display');

    function add(c) {
        if(display.innerText === "즐거운 글자놀이") display.innerText = "";
        chars.push(c); update();
    }
    function del() { chars.pop(); update(); }
    function reset() { chars = []; display.innerText = "즐거운 글자놀이"; }
    function update() { display.innerText = Hangul.assemble(chars) || "즐거운 글자놀이"; }

    function speak() {
        const text = display.innerText;
        if(!text || text === "즐거운 글자놀이") return;

        window.speechSynthesis.cancel(); // 이전 음성 즉시 종료

        setTimeout(() => {
            const msg = new SpeechSynthesisUtterance(text);
            msg.lang = 'ko-KR';
            
            // 자연스러운 발음을 위한 핵심 설정
            msg.rate = 0.8;  // 너무 느리지 않게 속도 조절 (0.8~0.9가 가장 자연스러움)
            msg.pitch = 1.0; // 목소리 톤을 안정적으로 설정
            msg.volume = 1.0; // 소리 크기 최대

            // 브라우저에서 제공하는 가장 고품질의 한국어 목소리 찾기
            const voices = window.speechSynthesis.getVoices();
            // 'Google 한국어' 또는 엣지의 'SunHi' 등 자연스러운 목소리 우선 선택
            const preferredVoice = voices.find(v => v.name.includes('Google') && v.lang === 'ko-KR') || 
                                   voices.find(v => v.lang.includes('ko'));
            
            if (preferredVoice) msg.voice = preferredVoice;

            window.speechSynthesis.speak(msg);
        }, 150);
    }

    // 페이지 로드 시 음성 엔진 미리 준비 (부자연스러운 첫 발음 방지)
    window.speechSynthesis.onvoiceschanged = () => {
        window.speechSynthesis.getVoices();
    };
</script>
